name: Auto Assign PR Reviewer and Assignee

on:
  pull_request:
    types: [opened]

jobs:
  assign:
    runs-on: ubuntu-latest
    permissions:
      pull-requests: write
    steps:
      - name: Assign PR creator as assignee
        uses: actions/github-script@v7
        with:
          script: |
            const prNumber = context.payload.pull_request.number;
            const prCreator = context.payload.pull_request.user.login;

            // Assign PR creator as assignee
            await github.rest.issues.addAssignees({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: prNumber,
              assignees: [prCreator],
            });
            core.info(`Assigned ${prCreator} as assignee`);

            // Request review from the reviewers team
            try {
              await github.rest.pulls.requestReviewers({
                owner: context.repo.owner,
                repo: context.repo.repo,
                pull_number: prNumber,
                team_reviewers: ['reviewers'],
              });
              core.info('Requested review from @educational-design/reviewers');
            } catch (error) {
              core.warning(`Failed to request team review: ${error.message}`);
            }
